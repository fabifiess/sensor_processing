<!DOCTYPE html>
<html>
<head lang="en">
    <meta charset="UTF-8">
    <title>Drees 2 LED</title>
    <script src="../js/jquery-1.11.1.js"></script>
    <script src="../js/socket.io-1.3.2.js"></script>
</head>
<body>
<img src="../img/drees.jpg">
<pre id="output"></pre>

<script>
    var socket;
    window.onload = function () {
        socket = io();
    };



    var outputRGB = "000000";

    $('img').mousedown(function (e) {
        if (!this.canvas) {
            this.canvas = $('<canvas />')[0];
            this.canvas.width = this.width;
            this.canvas.height = this.height;
            this.canvas.getContext('2d').drawImage(this, 0, 0, this.width, this.height);
        }
        var pixelData = this.canvas.getContext('2d').getImageData(event.offsetX, event.offsetY, 1, 1).data;
        outputRGB = rgbToHex(pixelData[0], pixelData[1], pixelData[2]);
        $('#output').html(outputRGB);
    });

    setInterval(function () {
//        var prevColor = outputRGB;
        if (outputRGB != null) {
//            if (outputRGB != prevColor) {
            console.log(outputRGB);
            socket.emit('farbe_ClientToServer', outputRGB);
//            }
        }
    }, 200);




    // RGB to Hex

    function componentToHex(c) {
        var hex = c.toString(16);
        return hex.length == 1 ? "0" + hex : hex;
    }

    function rgbToHex(r, g, b) {
        return componentToHex(r) + componentToHex(g) + componentToHex(b);
    }
</script>

</body>
</html>